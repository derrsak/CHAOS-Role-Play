const cfgRoulette = {
	offsets: {
		markers: {
			"0": [-0.137451171875, -0.146942138671875, 0.9449996948242188],
			"00": [-0.1387939453125, 0.10546875, 0.9449996948242188],
			"1": [-0.0560302734375, -0.1898193359375, 0.9449996948242188],
			"2": [-0.0567626953125, -0.024017333984375, 0.9449996948242188],
			"3": [-0.056884765625, 0.141632080078125, 0.9449996948242188],
			"4": [0.02392578125, -0.187347412109375, 0.9449996948242188],
			"5": [0.0240478515625, -0.02471923828125, 0.9449996948242188],
			"6": [0.02392578125, 0.1422119140625, 0.9449996948242188],
			"7": [0.1038818359375, -0.18902587890625, 0.9449996948242188],
			"8": [0.1044921875, -0.023834228515625, 0.9449996948242188],
			"9": [0.10546875, 0.1419677734375, 0.9449996948242188],
			"10": [0.18701171875, -0.188385009765625, 0.9449996948242188],
			"11": [0.18603515625, -0.0238037109375, 0.9449996948242188],
			"12": [0.1851806640625, 0.143157958984375, 0.9449996948242188],
			"13": [0.2677001953125, -0.18780517578125, 0.9449996948242188],
			"14": [0.26806640625, -0.02301025390625, 0.9449996948242188],
			"15": [0.26611328125, 0.143310546875, 0.9449996948242188],
			"16": [0.3497314453125, -0.18829345703125, 0.9449996948242188],
			"17": [0.349609375, -0.023101806640625, 0.9449996948242188],
			"18": [0.3497314453125, 0.142242431640625, 0.9449996948242188],
			"19": [0.4307861328125, -0.18829345703125, 0.9449996948242188],
			"20": [0.4312744140625, -0.02392578125, 0.9449996948242188],
			"21": [0.431884765625, 0.1416015625, 0.9449996948242188],
			"22": [0.51220703125, -0.188873291015625, 0.9449996948242188],
			"23": [0.5123291015625, -0.023773193359375, 0.9449996948242188],
			"24": [0.511962890625, 0.14215087890625, 0.9449996948242188],
			"25": [0.5931396484375, -0.18890380859375, 0.9449996948242188],
			"26": [0.59375, -0.023651123046875, 0.9449996948242188],
			"27": [0.59375, 0.14080810546875, 0.9449996948242188],
			"28": [0.67529296875, -0.189849853515625, 0.9449996948242188],
			"29": [0.6751708984375, -0.02337646484375, 0.9449996948242188],
			"30": [0.674560546875, 0.141845703125, 0.9449996948242188],
			"31": [0.756591796875, -0.18798828125, 0.9449996948242188],
			"32": [0.7547607421875, -0.0234375, 0.9449996948242188],
			"33": [0.7554931640625, 0.14263916015625, 0.9449996948242188],
			"34": [0.836669921875, -0.188323974609375, 0.9449996948242188],
			"35": [0.8365478515625, -0.0244140625, 0.9449996948242188],
			"36": [0.8359375, 0.14276123046875, 0.9449996948242188]
		},
		chips: [
			[-0.154541015625, -0.150604248046875, 0.9449996948242188, ["0"]],
			[-0.1561279296875, 0.11505126953125, 0.9449996948242188, ["00"]],
			[-0.059326171875, -0.18701171875, 0.9449996948242188, ["1"]],
			[-0.058349609375, -0.019378662109375, 0.9449996948242188, ["2"]],
			[-0.0587158203125, 0.142059326171875, 0.9449996948242188, ["3"]],
			[0.02294921875, -0.1920166015625, 0.9449996948242188, ["4"]],
			[0.023193359375, -0.01947021484375, 0.9449996948242188, ["5"]],
			[0.024658203125, 0.147369384765625, 0.9449996948242188, ["6"]],
			[0.105224609375, -0.1876220703125, 0.9449996948242188, ["7"]],
			[0.1055908203125, -0.028472900390625, 0.9449996948242188, ["8"]],
			[0.10400390625, 0.147430419921875, 0.9449996948242188, ["9"]],
			[0.187744140625, -0.191802978515625, 0.9449996948242188, ["10"]],
			[0.1866455078125, -0.02667236328125, 0.9449996948242188, ["11"]],
			[0.1842041015625, 0.145965576171875, 0.9449996948242188, ["12"]],
			[0.2696533203125, -0.182464599609375, 0.9449996948242188, ["13"]],
			[0.265869140625, -0.027862548828125, 0.9449996948242188, ["14"]],
			[0.2667236328125, 0.138946533203125, 0.9449996948242188, ["15"]],
			[0.35009765625, -0.186126708984375, 0.9449996948242188, ["16"]],
			[0.348876953125, -0.027740478515625, 0.9449996948242188, ["17"]],
			[0.3497314453125, 0.14715576171875, 0.9449996948242188, ["18"]],
			[0.43212890625, -0.17864990234375, 0.9449996948242188, ["19"]],
			[0.4337158203125, -0.02508544921875, 0.9449996948242188, ["20"]],
			[0.430419921875, 0.138336181640625, 0.9449996948242188, ["21"]],
			[0.51416015625, -0.18603515625, 0.9449996948242188, ["22"]],
			[0.5135498046875, -0.02301025390625, 0.9449996948242188, ["23"]],
			[0.5146484375, 0.14239501953125, 0.9449996948242188, ["24"]],
			[0.59130859375, -0.192413330078125, 0.9449996948242188, ["25"]],
			[0.596923828125, -0.022216796875, 0.9449996948242188, ["26"]],
			[0.5924072265625, 0.14385986328125, 0.9449996948242188, ["27"]],
			[0.6749267578125, -0.187286376953125, 0.9449996948242188, ["28"]],
			[0.67431640625, -0.0262451171875, 0.9449996948242188, ["29"]],
			[0.6756591796875, 0.140594482421875, 0.9449996948242188, ["30"]],
			[0.7542724609375, -0.19415283203125, 0.9449996948242188, ["31"]],
			[0.7542724609375, -0.01898193359375, 0.9449996948242188, ["32"]],
			[0.75439453125, 0.1448974609375, 0.9449996948242188, ["33"]],
			[0.8392333984375, -0.18951416015625, 0.9449996948242188, ["34"]],
			[0.837646484375, -0.023468017578125, 0.9449996948242188, ["35"]],
			[0.8380126953125, 0.14227294921875, 0.9449996948242188, ["36"]],
			[0.0643310546875, -0.304718017578125, 0.9449996948242188, ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"]],
			[0.392822265625, -0.304779052734375, 0.9449996948242188, ["13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24"]],
			[0.712158203125, -0.30303955078125, 0.9449996948242188, ["25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36"]],
			[0.9222412109375, -0.185882568359375, 0.9449996948242188, ["1", "4", "7", "10", "13", "16", "19", "22", "25", "28", "31", "34"]],
			[0.9229736328125, -0.0181884765625, 0.9449996948242188, ["2", "5", "8", "11", "14", "17", "20", "23", "26", "29", "32", "35"]],
			[0.9248046875, 0.14849853515625, 0.9449996948242188, ["3", "6", "9", "12", "15", "18", "21", "24", "27", "30", "33", "36"]],
			[-0.011474609375, -0.378875732421875, 0.9449996948242188, ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18"]],//1-18
			[0.142822265625, -0.375732421875, 0.9449996948242188, ["2", "4", "6", "8", "10", "12", "14", "16", "18", "20", "22", "24", "26", "28", "30", "32", "34", "36"]], //even
			[0.308349609375, -0.37542724609375, 0.9449996948242188, ["1", "3", "5", "7", "9", "12", "14", "16", "18", "19", "21", "23", "25", "27", "30", "32", "34", "36"]],//red
			[0.4713134765625, -0.376861572265625, 0.9449996948242188, ["2", "4", "6", "8", "10", "11", "13", "15", "17", "20", "22", "24", "26", "28", "29", "31", "33", "35"]],//black
			[0.6341552734375, -0.376495361328125, 0.9449996948242188, ["1", "3", "5", "7", "9", "11", "13", "15", "17", "19", "21", "23", "25", "27", "29", "31", "33", "35"]],//odd
			[0.7926025390625, -0.382232666015625, 0.9449996948242188, ["19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36"]]//19-36
		]
	},
	sound: 'DLC_VINEWOOD/CASINO_GENERAL',
	animations: [
		'anim_casino_b@amb@casino@games@shared@dealer@',
		'anim_casino_b@amb@casino@games@shared@player@',
		"anim_casino_b@amb@casino@games@roulette@table",
		"anim_casino_b@amb@casino@games@roulette@dealer",
		"anim_casino_b@amb@casino@games@roulette@ped_male@seat_1@regular@01a@base",
		"anim_casino_a@amb@casino@games@lucky7wheel@male"
	],
	ballHash: 87196104,
	tableHash: 623773339,
	tables: {
		0: {
			pos: new mp.Vector3(1144.814, 268.2634, -52.8409),
			h: -135,
			dealer: {
				hash: 0x1422D45B,
				pos: new mp.Vector3(1145.337, 267.7967, -51.8409),
				angle: 47.
			},
			camera: {
				pos: new mp.Vector3(1143.73, 268.9541, -52.960873 + 3.5),
				h: 225
			}
		},
		1: {
			pos: new mp.Vector3(1150.355, 262.7224, -52.8409),
			h: 45,
			dealer: {
				hash: 0x1422D45B,
				pos: new mp.Vector3(1149.791, 263.1628, -51.8409),
				angle: 222.2
			},
			camera: {
				pos: new mp.Vector3(1151.4585, 262.04517, -52.96084 + 3.5),
				h: 45
			}
		}
	}
}

class Roulette {
	constructor() {
		this.dealers = [];
		this.tables = [];

		this.doBet = false;

		this.markers = [];

		this.closestChipSpot = null;

		this.tableMarkers = [];

		this.betRoulette = [
			[],
			[]
		];

		mp.events.add('render', this.render.bind(this));


		mp.events.add('characterInit.done', this.init.bind(this));



		mp.events.add('clean_chips', this.clean_chips.bind(this));
		mp.events.add('exitRoultteUI', this.exitRouletteUI.bind(this));
		mp.events.add('updateCasinoTime', this.updateCasinoTime.bind(this));
		mp.events.add('updateCasinoChips', this.updateCasinoChips.bind(this));
		mp.events.add('roulette_enter', this.onEnterRoulette.bind(this));
		mp.events.add('setBetComplete', this.setBetComplete.bind(this));
		mp.events.add('spin_wheel', this.spinWheel.bind(this));
		mp.events.add("bet_roulette", this.betRouletteFunction.bind(this));
		mp.events.add('seat_to_roulette_table', this.seatToRoulette.bind(this));
		mp.events.add("client_casino_bet", this.casinoClientBet.bind(this));
		mp.events.add("exit_roulette", this.exitRoulette.bind(this));
		mp.events.add("casinoBet", this.casinoBet.bind(this));
		mp.events.add("start_roulette", this.startRouletteFunction.bind(this));
		mp.events.add("stop_roulette", this.stopRouletteFunction.bind(this));
		mp.events.add('rouletteDenyBet', this.denyBet.bind(this));

		this.setBet = false;
		this.rouletteCamera = null;
		this.betObject = null;
		this.betCoords = null;

		this.inRoulette = false;

		mp.keys.bind(69, true, this.keyE.bind(this));
		mp.keys.bind(27, true, this.keyEsc.bind(this));
	}
	denyBet() {
		this.doBet = false;
		this.clearTableMarkers();
		if (this.betObject != null || this.betObject !== undefined) {
			if (this.betObject) {
				this.betObject.destroy();
			}
			this.betObject = null;
		}
	}
	startRouletteFunction() {
		this.startRoullete = true;

		this.clearTableMarkers();
	}
	stopRouletteFunction() {
		mp.callCEFV(`casino.rest()`);

		if (this.doBet) this.doBet = false;

		this.startRoullete = false;
	}
	casinoBet(val) {
		this.setBet = true;
		mp.events.callRemote('serverSetRouletteBet', val);
	}
	exitRoulette() {
		this.tables[this.rouletteTable].table.setCollision(true, false);
		mp.game.cam.renderScriptCams(false, true, 1000, true, false);
		mp.players.local.freezePosition(false);

		this.ready = false;
		this.setBet = false;

		this.clearTableMarkers();
		this.deleteBet();
		mp.callCEFV(`casino.hide()`);
		this.blockControls = false;
		this.rouletteTable = null;
	}
	deleteBet() {
		if (this.betObject) {
			this.betObject.destroy();
			this.betObject = null;
		}
	}
	casinoClientBet(act, min, max, chips) {
		switch (act) {
			case 'open':
				mp.busy.add("roulette");
				mp.callCEFV(`casino.show(${min}, ${max}, ${chips})`);
				break;
			case 'close':
				mp.busy.remove("roulette");
				mp.callCEFV(`casino.hide()`);
				break;
		}
	}

	seatToRoulette(table) {
		this.blockControls = true;
		this.rouletteTable = table;

		mp.players.local.freezePosition(true);
		this.rightAxisX = 0;
		this.rightAxisY = 0;
		this.setBet = false;

		this.rouletteCamera = mp.cameras.new('default', cfgRoulette.tables[table].camera.pos, new mp.Vector3(90, 0, 0), 40);
		this.rouletteCamera.setRot(-63, 0, cfgRoulette.tables[table].camera.h, 2);
		this.rouletteCamera.setActive(true);

		mp.game.cam.renderScriptCams(true, true, 1500, true, false);

		setTimeout(() => this.ready = true, 2000);
	}
	betRouletteFunction(table, spot) {
		const tablePos = this.tables[table].table.position;
		const betOffset = cfgRoulette.offsets.chips[spot];
		const newCardPos = mp.game.object.getObjectOffsetFromCoords(tablePos.x, tablePos.y, tablePos.z, cfgRoulette.tables[table].h, betOffset[0], betOffset[1], betOffset[2]);

		this.betRoulette[table].push(mp.objects.new(mp.game.joaat(`vw_prop_chip_100dollar_x1`), new mp.Vector3(newCardPos.x, newCardPos.y, newCardPos.z), {
			rotation: new mp.Vector3(0, 0, 0),
			dimension: 0
		}));
	}
	spinWheel(tb, needSpins, endTable, endBall) {
		this.tables[tb].table.playAnim("intro_wheel", "anim_casino_b@amb@casino@games@roulette@table", 1000.0, false, true, true, 0, 131072);
		this.tables[tb].table.forceAiAndAnimationUpdate();

		const ballPos = this.tables[tb].table.getWorldPositionOfBone(this.tables[tb].table.getBoneIndexByName("Roulette_Wheel"));
		this.tables[tb].ball.position = ballPos;
		this.tables[tb].ball.setCoordsNoOffset(ballPos.x, ballPos.y, ballPos.z, !1, !1, !1);

		const ballRot = this.tables[tb].table.getRotation(2);
		this.tables[tb].ball.setRotation(ballRot.x, ballRot.y, ballRot.z + 90, 2, !1)
		this.tables[tb].ball.playAnim("intro_ball", "anim_casino_b@amb@casino@games@roulette@table", 1000.0, false, true, false, 0, 136704);
		this.tables[tb].ball.forceAiAndAnimationUpdate();

		this.tables[tb].spins = 0;
		this.tables[tb].lastSpinTime = 0;
		this.tables[tb].needSpins = needSpins;
		this.tables[tb].lowSpeed = false;
		this.tables[tb].ending = false;
		this.tables[tb].endTable = endTable;
		this.tables[tb].endBall = endBall;

		this.dealers[tb].taskPlayAnim("anim_casino_b@amb@casino@games@roulette@dealer", "spin_wheel", 8.0, 1, -1, 2, 0.0, false, false, false);
		mp.timer.add(() => this.dealers[tb].taskPlayAnim("anim_casino_b@amb@casino@games@roulette@dealer", "idle", 8.0, 1, -1, 1, 0.0, false, false, false), 8000);
	}
	onEnterRoulette(state) {
		this.inRoulette = state;

		if (state) mp.prompt.show(`Нажмите <span>E</span> для того, чтобы сесть за стол`);
		else mp.prompt.hide();
	}
	setBetComplete() {
		this.bet = true;

		this.clearTableMarkers();
		this.deleteBet();
	}
	exitRouletteUI() {
		mp.events.callRemote("exitRoulette");
	}
	updateCasinoTime(seconds) {
		mp.callCEFV(`casino.setTimeToStart(${seconds})`);
	}
	updateCasinoChips(chips) {
		mp.callCEFV(`casino.setChips(${chips})`);
	}
	keyE() {
		if (!this.inRoulette || mp.busy.includes()) return;
		mp.events.callRemote('roulette_seat');
		mp.prompt.hide();
	}
	keyEsc() {
		if (this.inRoulette) {
			this.exitRouletteUI();
		}
	}
	clean_chips(table) {
		this.dealers[table].taskPlayAnim("anim_casino_b@amb@casino@games@roulette@dealer", "clear_chips_intro", 3.0, 1.0, -1, 2, 0, false, false, false);

		for (let i = 0; i < this.betRoulette[table].length; i++) {
			if (this.betRoulette[table][i] != null) {
				this.betRoulette[table][i].destroy();
			}
		}

		this.betRoulette[table] = [];

		mp.timer.add(() => {
			this.dealers[table].taskPlayAnim("anim_casino_b@amb@casino@games@roulette@dealer", "clear_chips_outro", 3.0, 1.0, -1, 2, 0, false, false, false)
		}, 1000);
	}
	clearTableMarkers() {
		if (this.tableMarkers.length === 0) {
			return;
		}

		for (let i = 0; i < this.tableMarkers.length; i++) {
			this.tableMarkers[i].destroy();
		}

		this.tableMarkers = [];
	}
	getDistanceBetweenPoints3D(v1, v2) {
		return Math.abs(Math.sqrt(Math.pow((v2.x - v1.x), 2) + Math.pow((v2.y - v1.y), 2) + Math.pow((v2.z - v1.z), 2)));
	}
	getClosestChipSpot(vector) {
		let spot = null,
			prevDistance = 0.05,
			dist = null;

		for (let i = 0; i < cfgRoulette.offsets.chips.length; i++) {
			let offsetPos = this.tables[this.rouletteTable].table.getOffsetFromInWorldCoords(cfgRoulette.offsets.chips[i][0], cfgRoulette.offsets.chips[i][1], cfgRoulette.offsets.chips[i][2]);
			dist = this.getDistanceBetweenPoints3D(vector, new mp.Vector3(offsetPos.x, offsetPos.y, offsetPos.z));

			if (dist <= prevDistance) {
				spot = i;
				prevDistance = dist;
			}
		}

		if (spot !== this.closestChipSpot) {
			this.closestChipSpot = spot;
			this.clearTableMarkers();

			if (spot !== null) {
				let key = null,
					obj = null;

				for (let i = 0; i < cfgRoulette.offsets.chips[spot][3].length; i++) {
					key = cfgRoulette.offsets.chips[spot][3][i];
					if (key === "00" || key === "0") {
						let offsetPos = this.tables[this.rouletteTable].table.getOffsetFromInWorldCoords(cfgRoulette.offsets.markers[key][0], cfgRoulette.offsets.markers[key][1], cfgRoulette.offsets.markers[key][2]);
						obj = mp.objects.new(269022546, new mp.Vector3(offsetPos.x, offsetPos.y, offsetPos.z), {
							rotation: new mp.Vector3(0, 0, cfgRoulette.tables[this.rouletteTable].h),
						});

						this.tableMarkers.push(obj);
					} else {
						let offsetPos = this.tables[this.rouletteTable].table.getOffsetFromInWorldCoords(cfgRoulette.offsets.markers[key][0], cfgRoulette.offsets.markers[key][1], cfgRoulette.offsets.markers[key][2]);
						this.tableMarkers.push(mp.objects.new(3267450776, new mp.Vector3(offsetPos.x, offsetPos.y, offsetPos.z), {
							rotation: new mp.Vector3(0, 0, cfgRoulette.tables[this.rouletteTable].h),
						}));
					}
				}
			}
		}

	}
	render() {
		if (this.blockControls) {
			mp.game.controls.disableControlAction(0, 257, true);
			mp.game.controls.disableControlAction(0, 22, true);
			mp.game.controls.disableControlAction(2, 25, true);
			mp.game.controls.disableControlAction(0, 23, true);
			mp.game.controls.disableControlAction(2, 24, true);
			mp.game.controls.disableControlAction(2, 69, true);
			mp.game.controls.disableControlAction(2, 70, true);
			mp.game.controls.disableControlAction(2, 92, true);
			mp.game.controls.disableControlAction(2, 140, true);
			mp.game.controls.disableControlAction(2, 141, true);
			mp.game.controls.disableControlAction(2, 263, true);
			mp.game.controls.disableControlAction(2, 264, true);
			mp.game.controls.disableControlAction(0, 21, true);
			mp.game.controls.disableControlAction(0, 23, true);
			mp.game.controls.disableControlAction(0, 32, true);
			mp.game.controls.disableControlAction(0, 33, true);
			mp.game.controls.disableControlAction(0, 34, true);
			mp.game.controls.disableControlAction(0, 35, true);
		}



		this.rouletteRender();

		if (this.doBet || !this.setBet || this.rouletteTable === null || this.startRoullete) return;

		if (!this.betObject) {

			this.betObject = mp.objects.new(
				mp.game.joaat("vw_prop_chip_100dollar_x1"),
				new mp.Vector3(this.tables[this.rouletteTable].table.position.x, this.tables[this.rouletteTable].table.position.y, this.tables[this.rouletteTable].table.position.z + 0.4)
			);

			this.betObject.setCollision(false, false);
		}


		if (this.betObject && this.ready) {
			if (mp.game.controls.isDisabledControlJustReleased(0, 24)) { // ЛКМ
				if (this.closestChipSpot != null) {
					mp.events.callRemote("server_make_roulette_bet", this.closestChipSpot);
				}
			}

			let rightAxisX = mp.game.controls.getDisabledControlNormal(0, 220);
			let rightAxisY = mp.game.controls.getDisabledControlNormal(0, 221);

			this.rightAxisX += rightAxisX / 10;
			this.rightAxisY += rightAxisY * -1 / 10;

			this.rightAxisX = Math.max(-0.21, Math.min(1, this.rightAxisX)); // X: от -0.21 до 1
			this.rightAxisY = Math.max(-0.4, Math.min(0.24, this.rightAxisY)); // Y: от -0.4 до 0.24

			let offsetPos = this.tables[this.rouletteTable].table.getOffsetFromInWorldCoords(this.rightAxisX, this.rightAxisY, 0.0);

			this.betObject.setCoordsNoOffset(offsetPos.x, offsetPos.y, cfgRoulette.tables[this.rouletteTable].pos.z + 0.95, false, false, false);
			this.getClosestChipSpot(new mp.Vector3(offsetPos.x, offsetPos.y, cfgRoulette.tables[this.rouletteTable].pos.z + 0.95));
		}
	}
	rouletteRender() {
		for (let i = 0; i < this.tables.length; i++) {
			if (this.tables[i].table.isPlayingAnim("anim_casino_b@amb@casino@games@roulette@table", "intro_wheel", 3)) {
				if (this.tables[i].table.getAnimCurrentTime("anim_casino_b@amb@casino@games@roulette@table", "intro_wheel") > 0.9425) {
					this.tables[i].table.playAnim("loop_wheel", "anim_casino_b@amb@casino@games@roulette@table", 1000.0, true, true, true, 0, 131072);
				}
			}

			if (this.tables[i].ball.isPlayingAnim("anim_casino_b@amb@casino@games@roulette@table", "intro_ball", 3)) {
				if (this.tables[i].ball.getAnimCurrentTime("anim_casino_b@amb@casino@games@roulette@table", "intro_ball") > 0.99) {
					const ballPos = this.tables[i].table.getWorldPositionOfBone(this.tables[i].table.getBoneIndexByName("Roulette_Wheel"));
					const ballRot = this.tables[i].table.getRotation(2);

					this.tables[i].ball.position = new mp.Vector3(ballPos.x, ballPos.y, ballPos.z);
					this.tables[i].ball.rotation = new mp.Vector3(ballRot.x, ballRot.y, ballRot.z + 90);

					this.tables[i].ball.playAnim("loop_ball", "anim_casino_b@amb@casino@games@roulette@table", 1000.0, true, true, false, 0, 136704); // loop, stayInAnim, ?
				}
			}

			if (this.tables[i].table.isPlayingAnim("anim_casino_b@amb@casino@games@roulette@table", "loop_wheel", 3)) {
				if (this.tables[i].table.getAnimCurrentTime("anim_casino_b@amb@casino@games@roulette@table", "loop_wheel") >= 0.9 && Date.now() - this.tables[i].lastSpinTime > 1000) {
					if (this.tables[i].ending) return;
					this.tables[i].spins++;
					this.tables[i].lastSpinTime = Date.now();
				}

				if (this.tables[i].spins === this.tables[i].needSpins - 1 && !this.tables[i].lowSpeed) {
					this.tables[i].ball.setAnimSpeed("anim_casino_b@amb@casino@games@roulette@table", "loop_ball", 0.70);
					this.tables[i].lowSpeed = true;
				}

				if (this.tables[i].spins === this.tables[i].needSpins && this.tables[i].table.getAnimCurrentTime("anim_casino_b@amb@casino@games@roulette@table", "loop_wheel") > 0.99 && this.tables[i].ending == false) {
					this.tables[i].ending = true;

					this.tables[i].table.playAnim(this.tables[i].endTable, "anim_casino_b@amb@casino@games@roulette@table", 1000.0, false, true, true, 0, 131072);

					const ballPos = this.tables[i].table.getWorldPositionOfBone(this.tables[i].table.getBoneIndexByName("Roulette_Wheel"));
					const ballRot = this.tables[i].table.getRotation(2);

					this.tables[i].ball.position = new mp.Vector3(ballPos.x, ballPos.y, ballPos.z);
					this.tables[i].ball.rotation = new mp.Vector3(ballRot.x, ballRot.y, ballRot.z + 90);

					this.tables[i].ball.playAnim(this.tables[i].endBall, "anim_casino_b@amb@casino@games@roulette@table", 1000.0, false, true, false, 0, 136704);
				}
			}
		}
	}
	init() {
		mp.game.audio.requestScriptAudioBank(cfgRoulette.sound, false);

		cfgRoulette.animations.forEach(anim => mp.game.streaming.requestAnimDict(anim));

		Object.keys(cfgRoulette.tables).forEach(key => {
			const table = cfgRoulette.tables[key];

			this.tables[key] = {};
			this.tables[key].table = mp.objects.new(cfgRoulette.tableHash, table.pos, {
				rotation: new mp.Vector3(0, 0, table.h)
			});

			this.tables[key].ball = mp.objects.new(cfgRoulette.ballHash, table.pos);

			const ped = cfgRoulette.tables[key].dealer;

			this.dealers[key] = mp.peds.new(ped.hash, ped.pos, ped.angle, 0);
			this.dealers[key].setComponentVariation(0, 2, 1, 0);
			this.dealers[key].setComponentVariation(1, 1, 0, 0);
			this.dealers[key].setComponentVariation(2, 2, 0, 0);
			this.dealers[key].setComponentVariation(3, 0, parseInt(key) + 2, 0);
			this.dealers[key].setComponentVariation(4, 0, 0, 0);
			this.dealers[key].setComponentVariation(6, 1, 0, 0);
			this.dealers[key].setComponentVariation(7, 2, 0, 0);
			this.dealers[key].setComponentVariation(8, 1, 0, 0);
			this.dealers[key].setComponentVariation(10, 1, 0, 0);
			this.dealers[key].setComponentVariation(11, 1, 0, 0);
			this.dealers[key].setConfigFlag(185, true);
			this.dealers[key].setConfigFlag(108, true);
			this.dealers[key].setConfigFlag(208, true);

			this.dealers[key].taskPlayAnim("anim_casino_b@amb@casino@games@shared@dealer@", "idle", 1000.0, -2.0, -1, 2, 1148846080, false, false, false);
		});
	}
}

const roulette = new Roulette();